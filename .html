<!DOCTYPE html>
<html lang="zh-tw">
<head>
    <meta charset="UTF-8">
    <title>Shadowing 練習</title>
    <style>
        .sentence {
            font-size: 18px;
            margin: 10px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        button {
            margin-left: 10px;
            padding: 5px;
        }
        .slider-container {
            text-align: center;
            margin: 20px 0;
        }
        .slider {
            width: 50%;
        }
    </style>
</head>
<body>

<h1>Shadowing 練習</h1>

<div class="slider-container">
    <label for="rateSlider">調整語速 Speed：</label>
    <input type="range" id="rateSlider" class="slider" min="0.5" max="1.5" step="0.1" value="1.0">
    <span id="rateDisplay">1.0</span>
</div>

<div id="practice-sentences">
    <div class="sentence">
        <span>你要冰的咖啡還是熱的咖啡？ <br><small>(nǐ yào bīng de kāfēi háishì rè de kāfēi?)</small></span>
        <button onclick="playTTS('你要冰的咖啡還是熱的咖啡？')">play</button>
    </div>
    <div class="sentence">
        <span>你要付現還是刷卡？ <br><small>(nǐ yào fùxiàn háishì shuākǎ?)</small></span>
        <button onclick="playTTS('你要付現還是刷卡？')">play</button>
    </div>
    <div class="sentence">
        <span>你要麵還是飯？ <br><small>(nǐ yào miàn háishì fàn?)</small></span>
        <button onclick="playTTS('你要麵還是飯？')">play</button>
    </div>
    <div class="sentence">
        <span>我們明天早上要開會還是要參加活動？ <br><small>(wǒmen míngtiān zǎoshang yào kāihuì háishì yào cānjiā huódòng?)</small></span>
        <button onclick="playTTS('我們明天早上要開會還是要參加活動？')">play</button>
    </div>
    <div class="sentence">
        <span>我們禮拜三開會還是禮拜五開會？ <br><small>(wǒmen lǐbài sān kāihuì háishì lǐbài wǔ kāihuì?)</small></span>
        <button onclick="playTTS('我們禮拜三開會還是禮拜五開會？')">play</button>
    </div>
    <div class="sentence">
        <span>他在外交領域還是在金融領域工作？ <br><small>(tā zài wàijiāo lǐngyù háishì zài jīnróng lǐngyù gōngzuò?)</small></span>
        <button onclick="playTTS('他在外交領域還是在金融領域工作？')">play</button>
    </div>
</div>

<script>
    const apiKey = "sk-XIgGZ-wLUW7f-vz7LG1cj3Baq4RhCvMKqG0_BXdmLXT3BlbkFJ8dtUbCsZCNMNSy-dB9acJS8OCrWj9-Dk12IBj43QcA"; // 替換為您的 API 金鑰

    // 使用 TTS API 播放音頻，包含語速調整
    async function playTTS(text) {
        const rate = document.getElementById("rateSlider").value;
        try {
            const response = await fetch("https://api.openai.com/v1/audio/speech", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: "tts-1",
                    input: text,
                    voice: "alloy",
                    speed: parseFloat(rate), // 傳遞語速參數
                    response_format: "mp3"
                })
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const audioBlob = await response.blob();
            const audioUrl = URL.createObjectURL(audioBlob);
            const audio = new Audio(audioUrl);
            audio.play();
        } catch (error) {
            console.error("API Error:", error);
            alert("無法播放語音，請確認 API 金鑰設定是否正確。");
        }
    }

    // 更新語速顯示
    const rateSlider = document.getElementById("rateSlider");
    const rateDisplay = document.getElementById("rateDisplay");
    rateSlider.oninput = function() {
        rateDisplay.textContent = this.value;
    }
</script>

</body>
</html>
